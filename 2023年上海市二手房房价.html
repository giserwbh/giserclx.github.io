<!DOCTYPE html><html lang="en"><head>  <meta charset="utf-8" />  <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />  <title>Intro to MapView - Create a 2D map | Sample | ArcGIS Maps SDK for JavaScript 4.29</title>  <style>        html,    body,        #viewDiv {      padding: 0;      margin: 0;      height: 100%;      width: 100%;    }    #header {      height: 90px;      background-color: #708090;      color: #fff;      text-align: center;      line-height: 50px;    }     #title {       font-size: 24px;      flex: 1; /* Allow the title to expand and occupy remaining space */      margin-left: 10px;    }    #widgets {      position: absolute;      top: 10px;      right: 10px;      z-index: 1000;    }    .esri-expand__content {      position: absolute;      right: 0;      left: auto;      z-index: 1;              }    #titleContainer,{      display: inline-block; /* Ensure elements are in the same line */      margin-left: 10px; /* Adjust spacing between elements */    }    #searchContainer,    #selectContainer,    #buttonContainer {      display: inline-block; /* Ensure elements are in the same line */      margin-right: 10px; /* Adjust spacing between elements */    }  </style>  <link rel="stylesheet" href="https://js.arcgis.com/4.29/esri/themes/light/main.css" />  <script src="https://js.arcgis.com/4.29/"></script>  <script>    require([      "esri/Map",      "esri/views/MapView",      "esri/layers/FeatureLayer",      "esri/widgets/ScaleBar",      "esri/widgets/Legend",      "esri/widgets/Search",      "esri/widgets/LayerList",      "esri/widgets/BasemapGallery",      "esri/widgets/Compass",      "esri/widgets/Home",      "esri/widgets/Expand"    ],function(Map, MapView, FeatureLayer, ScaleBar, Legend, Search, LayerList, BasemapGallery, Compass, Home, Expand) {      var flayer = new FeatureLayer({url:"https://www.geosceneonline.cn/server/rest/services/Hosted/我国2023年上海市的二手房房价情况/FeatureServer"});      var map1 = new Map({        basemap: "topo-vector",        layers:[flayer]      });      var view = new MapView({        container: "viewDiv",        map: map1,        zoom: 9,        center: [121.5, 31.3] // longitude, latitude      });      // 添加比例尺微件      var scaleBar = new ScaleBar({        view: view,        unit: "dual" // 双单位      });      view.ui.add(scaleBar, {        position: "bottom-left"      });      // 添加图例微件      var legend = new Legend({        view: view      });      //view.ui.add(legend, {      //position: "bottom-right"      //});      // 添加搜索微件      var searchWidget = new Search({        view: view      });      view.ui.add(searchWidget, {        position: "top-right"      });      // 添加图层列表微件      var layerList = new LayerList({        view: view      });      //view.ui.add(layerList, {      //position: "top-right"      //});        // 创建底图库微件      var basemapGallery = new BasemapGallery({        view: view,        source: {          portal: {            url: "https://www.arcgis.com",            useVectorBasemaps: true // 使用矢量底图          }        }      });      //view.ui.add(basemapGallery, {      //position: "left"      //});                    // 添加指南针微件      var compass = new Compass({        view: view      });      view.ui.add(compass, "top-left");      // 添加默认地图范围微件      var homeWidget = new Home({        view: view      });    view.ui.add(homeWidget, "top-left");        let expand = new Expand({          expandIconClass: "esri-icon-layers",          view: view,          content: legend,          group: "top-right"        });        view.ui.add(expand, "top-right");                    let expand2 = new Expand({          view: view,          content: layerList,          group: "top-right"          });        view.ui.add(expand2, "top-right");                let expand3 = new Expand({          view: view,          content: basemapGallery,          group: "top-right"          });        view.ui.add(expand3, "top-right");            // 添加属性查询功能      var queryInput = document.createElement("input");      queryInput.setAttribute("type", "text");      queryInput.setAttribute("id", "queryInput");      queryInput.setAttribute("placeholder", "输入查询关键字");      document.getElementById("widgets").appendChild(queryInput);      queryInput.style.display = "inline-block"; // 设置为内联块级元素      document.getElementById("widgets").appendChild(queryInput);      var selectBox = document.createElement("select");      selectBox.setAttribute("id", "selectBox");      document.getElementById("widgets").appendChild(selectBox);      selectBox.style.display = "inline-block"; // 设置为内联块级元素      selectBox.style.width = "150px"; // 设置宽度为 200 像素      selectBox.style.height = "20px";      document.getElementById("widgets").appendChild(selectBox);      var queryButton = document.createElement("button");      queryButton.innerText = "执行查询";      queryButton.addEventListener("click", executeQuery);      document.getElementById("widgets").appendChild(queryButton);      queryButton.style.marginright = "2px"      queryButton.style.display = "inline-block"; // 设置为内联块级元素      document.getElementById("widgets").appendChild(queryButton);            function executeQuery() {        var keyword = document.getElementById("queryInput").value;        if (!keyword) return; // 确保查询关键字不为空        // 构造模糊查询表达式        var queryExpression = "县 LIKE '%" + keyword + "%'";        // 创建查询任务        var query = flayer.createQuery();        query.where = queryExpression;        query.outFields = ["县", "f2023"];        // 执行查询        flayer.queryFeatures(query)          .then(function(response) {            var selectBox = document.getElementById("selectBox");            selectBox.innerHTML = ""; // 清空下拉框            if (response.features.length > 0) {              response.features.forEach(function(feature) {                var option = document.createElement("option");                option.text = feature.attributes["县"];                option.value = feature.attributes["f2023"];                selectBox.add(option);              });              selectBox.style.display = "block"; // 显示下拉框              var value = response.features[0].attributes["f2023"];              var countyName = response.features[0].attributes["县"];              alert("2023年"+countyName + "二手房房价为" + value);            } else {              alert("未找到匹配的要素。");              selectBox.style.display = "none"; // 隐藏下拉框            }          })          .catch(function(error) {            console.error("查询失败:", error);            alert("查询失败，请查看控制台输出以获取更多信息。");          });      }      // 添加统计分析按钮      var statisticsButton = document.createElement("button");      statisticsButton.innerText = "统计分析";      statisticsButton.addEventListener("click", performStatistics);      document.getElementById("widgets").appendChild(statisticsButton);      statisticsButton.style.marginright = "10px"      function performStatistics() {        // 创建查询任务        var query = flayer.createQuery();        query.outFields = ["f2023"];        // 执行查询        flayer.queryFeatures(query)          .then(function(response) {            if (response.features.length > 0) {              // 计算平均值              var sum = 0;              response.features.forEach(function(feature) {                sum += feature.attributes["f2023"];              });              var average = sum / response.features.length;              // 计算最大值              var max = Math.max.apply(null, response.features.map(function(feature) {                return feature.attributes["f2023"];              }));              // 计算最小值              var min = Math.min.apply(null, response.features.map(function(feature) {                return feature.attributes["f2023"];              }));              // 显示统计结果              alert("2023年上海市各县区二手房房价情况"+"\n平均值: " + average + "\n最大值: " + max + "\n最小值: " + min);            } else {              alert("未找到要素。");            }          })          .catch(function(error) {            console.error("统计分析失败:", error);            alert("统计分析失败，请查看控制台输出以获取更多信息。");          });      }      // 创建搜索容器并添加到页面        var searchContainer = document.createElement("div");        searchContainer.setAttribute("id", "searchContainer");        searchContainer.appendChild(queryInput);        // 创建下拉菜单容器并添加到页面        var selectContainer = document.createElement("div");        selectContainer.setAttribute("id", "selectContainer");        selectContainer.appendChild(selectBox);      // 创建按钮容器并添加到页面        var buttonContainer = document.createElement("div");        buttonContainer.setAttribute("id", "buttonContainer");        buttonContainer.appendChild(queryButton);        buttonContainer.appendChild(statisticsButton);      // 创建标题容器并添加到页面        var titleContainer = document.createElement("div");        titleContainer.setAttribute("id", "title");        titleContainer.innerText = "2023年上海市县区二手房房价情况";        // 将所有元素添加到页眉        var header = document.getElementById("header");        header.appendChild(titleContainer);        header.appendChild(searchContainer);        header.appendChild(selectContainer);        header.appendChild(buttonContainer);    });  </script></head><body>  <div id="header"></div>  <div id="viewDiv"></div>  <div id="widgets"></div></body></html>